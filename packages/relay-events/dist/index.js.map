{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { z } from 'zod';\n\nconst baseEnvelopeSchema = z.object({\n  sessionId: z.string().min(1),\n  timestamp: z.string().datetime().optional(),\n  nonce: z.string().min(8).optional(),\n});\n\nconst snapshotEvent = baseEnvelopeSchema.extend({\n  event: z.literal('session.snapshot'),\n  payload: z.object({\n    snapshot: z.record(z.string(), z.unknown()).optional(),\n  }),\n});\n\nconst voteCastEvent = baseEnvelopeSchema.extend({\n  event: z.literal('vote.cast'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    participantId: z.string().min(1),\n    value: z.string().min(1).optional(),\n  }),\n});\n\nconst votesClearedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('votes.cleared'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    actorId: z.string().min(1),\n  }),\n});\n\nconst issueRevealedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('issue.revealed'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    actorId: z.string().min(1),\n  }),\n});\n\nconst issueAdvanceEvent = baseEnvelopeSchema.extend({\n  event: z.literal('issue.advance'),\n  payload: z.object({\n    fromIssueKey: z.string().min(1).optional(),\n    toIssueKey: z.string().min(1),\n    actorId: z.string().min(1),\n  }),\n});\n\nconst participantJoinedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('participant.joined'),\n  payload: z.object({\n    participantId: z.string().min(1),\n    displayName: z.string().min(1),\n  }),\n});\n\nconst participantLeftEvent = baseEnvelopeSchema.extend({\n  event: z.literal('participant.left'),\n  payload: z.object({\n    participantId: z.string().min(1),\n  }),\n});\n\nconst sessionJoinedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('session.joined'),\n  payload: z.object({\n    participantId: z.string().min(1),\n    displayName: z.string().min(1),\n  }),\n});\n\nconst sessionBacklogUpdatedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('session.backlogUpdated'),\n  payload: z.object({\n    issueCount: z.number().int().min(0),\n    actorId: z.string().min(1),\n  }),\n});\n\nconst sessionStartedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('session.started'),\n  payload: z.object({\n    actorId: z.string().min(1),\n  }),\n});\n\nconst participantReadyEvent = baseEnvelopeSchema.extend({\n  event: z.literal('participant.ready'),\n  payload: z.object({\n    participantId: z.string().min(1),\n    isReady: z.boolean(),\n  }),\n});\n\nexport const relayEventEnvelopeSchema = z.discriminatedUnion('event', [\n  snapshotEvent,\n  voteCastEvent,\n  votesClearedEvent,\n  issueRevealedEvent,\n  issueAdvanceEvent,\n  participantJoinedEvent,\n  participantLeftEvent,\n  sessionJoinedEvent,\n  sessionBacklogUpdatedEvent,\n  sessionStartedEvent,\n  participantReadyEvent,\n  baseEnvelopeSchema.extend({\n    event: z.literal('game.state'),\n    payload: z.object({\n      bugs: z.array(z.object({\n        id: z.number(),\n        x: z.number(),\n        y: z.number(),\n        type: z.enum(['bug', 'feature']),\n        createdAt: z.number(),\n      })),\n      scores: z.record(z.string(), z.number()),\n      timeLeft: z.number(),\n    }),\n  }),\n  baseEnvelopeSchema.extend({\n    event: z.literal('game.spawn'),\n    payload: z.object({\n      bug: z.object({\n        id: z.number(),\n        x: z.number(),\n        y: z.number(),\n        type: z.enum(['bug', 'feature']),\n        createdAt: z.number(),\n      }),\n    }),\n  }),\n  baseEnvelopeSchema.extend({\n    event: z.literal('game.smashed'),\n    payload: z.object({\n      bugId: z.number(),\n      actorId: z.string(),\n      newScore: z.number(),\n    }),\n  }),\n  baseEnvelopeSchema.extend({\n    event: z.literal('game.start'),\n    payload: z.object({\n      sessionId: z.string(),\n    }),\n  }),\n]);\n\nexport type RelayEventEnvelope = z.infer<typeof relayEventEnvelopeSchema>;\nexport type RelayEventName = RelayEventEnvelope['event'];\n\nexport type RelayEventPayload<Name extends RelayEventName = RelayEventName> = Extract<\n  RelayEventEnvelope,\n  { event: Name }\n>['payload'];\n\nexport type RelayEventPayloads = {\n  [Name in RelayEventName]: RelayEventPayload<Name>;\n};\n"],"mappings":"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","names":[]}