{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { z } from 'zod';\n\nconst baseEnvelopeSchema = z.object({\n  sessionId: z.string().min(1),\n  timestamp: z.string().datetime().optional(),\n  nonce: z.string().min(8).optional(),\n});\n\nconst snapshotEvent = baseEnvelopeSchema.extend({\n  event: z.literal('session.snapshot'),\n  payload: z.object({\n    snapshot: z.record(z.string(), z.unknown()).optional(),\n  }),\n});\n\nconst voteCastEvent = baseEnvelopeSchema.extend({\n  event: z.literal('vote.cast'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    participantId: z.string().min(1),\n    value: z.string().min(1).optional(),\n  }),\n});\n\nconst votesClearedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('votes.cleared'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    actorId: z.string().min(1),\n  }),\n});\n\nconst issueRevealedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('issue.revealed'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    actorId: z.string().min(1),\n  }),\n});\n\nconst issueAdvanceEvent = baseEnvelopeSchema.extend({\n  event: z.literal('issue.advance'),\n  payload: z.object({\n    fromIssueKey: z.string().min(1).optional(),\n    toIssueKey: z.string().min(1),\n    actorId: z.string().min(1),\n  }),\n});\n\nconst participantJoinedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('participant.joined'),\n  payload: z.object({\n    participantId: z.string().min(1),\n    displayName: z.string().min(1),\n  }),\n});\n\nconst participantLeftEvent = baseEnvelopeSchema.extend({\n  event: z.literal('participant.left'),\n  payload: z.object({\n    participantId: z.string().min(1),\n  }),\n});\n\nconst sessionBacklogUpdatedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('session.backlogUpdated'),\n  payload: z.object({\n    issueCount: z.number().int().min(0),\n    actorId: z.string().min(1),\n  }),\n});\n\nconst sessionStartedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('session.started'),\n  payload: z.object({\n    actorId: z.string().min(1),\n  }),\n});\n\nconst participantReadyEvent = baseEnvelopeSchema.extend({\n  event: z.literal('participant.ready'),\n  payload: z.object({\n    participantId: z.string().min(1),\n    isReady: z.boolean(),\n  }),\n});\n\nconst participantStatusChangedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('participant.status.changed'),\n  payload: z.object({\n    participantId: z.string().min(1),\n    status: z.enum(['online', 'away', 'offline']),\n  }),\n});\n\nconst participantRoleChangedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('participant.role.changed'),\n  payload: z.object({\n    participantId: z.string().min(1),\n    isObserver: z.boolean(),\n    isModerator: z.boolean(),\n  }),\n});\n\nconst sessionPausedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('session.paused'),\n  payload: z.object({\n    actorId: z.string().min(1),\n  }),\n});\n\nconst sessionResumedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('session.resumed'),\n  payload: z.object({\n    actorId: z.string().min(1),\n  }),\n});\n\nconst sessionCompletedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('session.completed'),\n  payload: z.object({\n    completedAt: z.string().datetime(),\n    actorId: z.string().min(1),\n    summary: z.object({\n      totalIssues: z.number(),\n      estimatedIssues: z.number(),\n      skippedIssues: z.number(),\n      duration: z.number(),\n    }),\n  }),\n});\n\nconst sessionSettingsUpdatedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('session.settings.updated'),\n  payload: z.object({\n    actorId: z.string().min(1),\n    settings: z.object({\n      autoReveal: z.boolean().optional(),\n      allowChangeVote: z.boolean().optional(),\n      timerEnabled: z.boolean().optional(),\n      timerSeconds: z.number().optional(),\n    }),\n  }),\n});\n\nconst voteUpdatedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('vote.updated'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    participantId: z.string().min(1),\n    previousValue: z.string().optional(),\n    newValue: z.string().optional(),\n    updatedAt: z.string().datetime(),\n  }),\n});\n\nconst voteRetractedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('vote.retracted'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    participantId: z.string().min(1),\n  }),\n});\n\nconst issueSkippedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('issue.skipped'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    actorId: z.string().min(1),\n    reason: z.string().optional(),\n  }),\n});\n\nconst consensusReachedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('consensus.reached'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    consensusValue: z.string().min(1),\n    voteCounts: z.record(z.string(), z.number()),\n    consensusType: z.enum(['unanimous', 'majority', 'moderator-override']),\n  }),\n});\n\nconst estimateAppliedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('estimate.applied'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    estimateValue: z.string().min(1),\n    appliedBy: z.string().min(1),\n    appliedAt: z.string().datetime(),\n  }),\n});\n\nconst voteTimerStartedEvent = baseEnvelopeSchema.extend({\n  event: z.literal('votes.timer.started'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    actorId: z.string().min(1),\n    durationSeconds: z.number().int().positive(),\n    endsAt: z.string().datetime(),\n  }),\n});\n\nconst voteTimerExpiredEvent = baseEnvelopeSchema.extend({\n  event: z.literal('votes.timer.expired'),\n  payload: z.object({\n    issueKey: z.string().min(1),\n    autoReveal: z.boolean(),\n  }),\n});\n\nexport const relayEventEnvelopeSchema = z.discriminatedUnion('event', [\n  snapshotEvent,\n  voteCastEvent,\n  voteUpdatedEvent,\n  voteRetractedEvent,\n  votesClearedEvent,\n  issueRevealedEvent,\n  issueAdvanceEvent,\n  issueSkippedEvent,\n  participantJoinedEvent,\n  participantLeftEvent,\n  participantReadyEvent,\n  participantStatusChangedEvent,\n  participantRoleChangedEvent,\n  sessionBacklogUpdatedEvent,\n  sessionStartedEvent,\n  sessionPausedEvent,\n  sessionResumedEvent,\n  sessionCompletedEvent,\n  sessionSettingsUpdatedEvent,\n  consensusReachedEvent,\n  estimateAppliedEvent,\n  voteTimerStartedEvent,\n  voteTimerExpiredEvent,\n  baseEnvelopeSchema.extend({\n    event: z.literal('game.state'),\n    payload: z.object({\n      bugs: z.array(z.object({\n        id: z.number(),\n        x: z.number(),\n        y: z.number(),\n        type: z.enum(['bug', 'feature']),\n        createdAt: z.number(),\n      })),\n      scores: z.record(z.string(), z.number()),\n      timeLeft: z.number(),\n    }),\n  }),\n  baseEnvelopeSchema.extend({\n    event: z.literal('game.spawn'),\n    payload: z.object({\n      bug: z.object({\n        id: z.number(),\n        x: z.number(),\n        y: z.number(),\n        type: z.enum(['bug', 'feature']),\n        createdAt: z.number(),\n      }),\n    }),\n  }),\n  baseEnvelopeSchema.extend({\n    event: z.literal('game.smashed'),\n    payload: z.object({\n      bugId: z.number(),\n      actorId: z.string(),\n      newScore: z.number(),\n    }),\n  }),\n  baseEnvelopeSchema.extend({\n    event: z.literal('game.start'),\n    payload: z.object({\n      sessionId: z.string(),\n    }),\n  }),\n]);\n\nexport type RelayEventEnvelope = z.infer<typeof relayEventEnvelopeSchema>;\nexport type RelayEventName = RelayEventEnvelope['event'];\n\nexport type RelayEventPayload<Name extends RelayEventName = RelayEventName> = Extract<\n  RelayEventEnvelope,\n  { event: Name }\n>['payload'];\n\nexport type RelayEventPayloads = {\n  [Name in RelayEventName]: RelayEventPayload<Name>;\n};\n"],"mappings":"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","names":[]}